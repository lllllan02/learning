---
title: GC 中的根节点概念
tags:
    - Golang
    - GC
    - GC Roots
date: 2026-01-18
order: 98
---

这句话描述的是垃圾回收（Garbage Collection, GC）中一个非常核心的概念：**GC Roots（垃圾回收根节点）**。

## 什么是“根节点”？
在 Go 语言（以及大多数现代编程语言）中，判断一个对象是否“存活”是通过 **可达性分析（Reachability Analysis）** 来实现的。

想象一下，程序中的所有对象就像是互相连接的节点。垃圾回收器需要知道哪些对象是可以丢掉的。它通过从一组特定的、程序 **绝对无法避开** 的起点开始遍历，顺着指针往下找。

*   **根节点**：就是这些“起点”。
*   **可达对象**：从根节点出发，通过指针直接或间接能找到的对象。
*   **不可达对象（垃圾）**：任何从根节点出发都找不着的内存，说明程序已经没有任何手段能访问到它们了，可以安全回收。

## 为什么说根节点是“肯定在使用的”？
根节点是程序执行的“触手”和“基础”。如果这些节点都不在了，程序也就没法运行了。

*   **局部变量（Local Variables）**： ^local-variables
    *   当你运行一个函数时，函数内部定义的变量存储在 **栈（Stack）** 上。
    *   只要这个函数还没执行完，这些变量就是程序当前正在操作的“现场”。如果 GC 把这些变量引用的对象删了，程序接下来的代码就会崩溃。
    *   因此，当前所有活跃的 Goroutine 栈上的指针都是根节点。

*   **全局变量（Global Variables）**： ^global-variables
    *   全局变量存在于程序的**数据段（Data Segment）** 中。
    *   它们在整个程序的生命周期内都存在。因为它们随时可能被任何函数访问，所以它们指向的对象必须被视为“正在使用”。

## 类比理解

你可以把这想象成一棵**倒挂的树**或者是**蜘蛛网**：

*   **根（Roots）**：是天花板上的挂钩（局部变量、全局变量）。
*   **绳子**：是对象之间的指针。
*   **重物**：是堆内存中的对象。

**GC 的逻辑是**：我只保留那些还挂在天花板上的东西。如果某段绳子断了，或者某个重物掉到了地上（没有任何绳子连着它，或者连着它的绳子最终没有连到天花板上），那它就是垃圾，该被清理掉。

## 总结
这句话的意思是：**垃圾回收不是漫无目的地扫描内存，而是从这些“铁证如山”的程序入口（局部变量、全局变量等）出发，顺藤摸瓜，保住所有能被摸到的对象，剩下的全部销毁。**

在 Go 的三色标记算法中，根节点就是最初被标记为“灰色”的那一批对象。

> - [ ] 三色标记算法